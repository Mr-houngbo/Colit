#!/bin/bash

echo "üîç Diagnostic ColiSpace Timeline"
echo "=================================="

echo ""
echo "üìã V√©rifications √† effectuer :"
echo ""

echo "1Ô∏è‚É£ V√©rifier que les scripts SQL ont √©t√© ex√©cut√©s dans Supabase :"
echo "   ‚úÖ table 'timeline_steps' existe"
echo "   ‚úÖ table 'coli_spaces' existe"
echo "   ‚úÖ fonction 'get_or_create_coli_space' existe"
echo "   ‚úÖ trigger 'create_timeline_steps_trigger' existe"

echo ""
echo "2Ô∏è‚É£ V√©rifier les donn√©es dans Supabase :"
echo "   - Aller dans Table Editor > timeline_steps"
echo "   - V√©rifier qu'il y a des donn√©es pour ton coli_space_id"
echo "   - Si vide, le probl√®me vient de l√†"

echo ""
echo "3Ô∏è‚É£ Test rapide :"
echo "   - Cr√©er un nouvel espace coli (nouvelle annonce)"
echo "   - V√©rifier si la timeline appara√Æt"
echo "   - Si oui, le probl√®me √©tait les anciennes donn√©es"

echo ""
echo "4Ô∏è‚É£ Debug console :"
echo "   - Ouvrir les logs Metro (terminal o√π tourne l'app)"
echo "   - Chercher les messages 'Timeline charg√©e depuis la BD' ou 'Aucune √©tape'"
echo "   - Partager ces logs si la timeline dispara√Æt toujours"

echo ""
echo "üîß Solutions possibles :"
echo ""
echo "A) Si table timeline_steps vide :"
echo "   - Les scripts SQL n'ont pas √©t√© ex√©cut√©s"
echo "   - Solution : Ex√©cuter database_schema.sql dans Supabase"
echo ""
echo "B) Si table existe mais pas de donn√©es pour cet espace :"
echo "   - L'espace coli a √©t√© cr√©√© avant les scripts SQL"
echo "   - Solution : Supprimer et recr√©er l'espace coli"
echo ""
echo "C) Si timeline appara√Æt 1s puis dispara√Æt :"
echo "   - Probl√®me de requ√™te ou de conversion de donn√©es"
echo "   - Les logs devraient montrer l'erreur exacte"

echo ""
echo "üéØ ACTION IMM√âDIATE :"
echo "1. V√©rifie que database_schema.sql a √©t√© ex√©cut√© dans Supabase"
echo "2. V√©rifie le contenu de la table timeline_steps"
echo "3. Red√©marre l'app compl√®tement"
echo "4. Teste avec un nouvel espace coli"

echo ""
echo "üìû Si probl√®me persiste, partage :"
echo "- Les logs de la console Metro"
echo "- Capture d'√©cran de Supabase > timeline_steps"
echo "- ID de l'espace coli qui pose probl√®me"
